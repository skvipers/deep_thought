# Система автоматического следования частей тела

## Обзор

Система автоматического следования позволяет частям тела пешки следовать за основными костями с заданной интенсивностью. Это создает более естественные движения и упрощает анимацию.

## Как это работает

### Принцип работы

1. **Основная кость** поворачивается (например, торс)
2. **Дочерние кости** автоматически следуют за ней с уменьшенной интенсивностью
3. **Создается эффект** естественного движения

### Интенсивность следования

- **Голова за торсом**: 30% интенсивности
- **Руки за торсом**: 40% интенсивности  
- **Ноги за торсом**: 30% интенсивности
- **Торс за головой**: 20% интенсивности

## Использование

### Базовые функции

```gdscript
# Поворот торса с автоматическим следованием всех частей
pawn_skeleton.set_torso_rotation_with_following(Vector3(0, 0, deg_to_rad(30)))

# Поворот головы с следованием тела
pawn_skeleton.set_head_rotation_with_body_following(Vector3(0, 0, deg_to_rad(20)))

# Сброс всех поз
pawn_skeleton.reset_all_poses()
```

### Примеры использования

```gdscript
# Поворот влево
pawn_skeleton.set_torso_rotation_with_following(Vector3(0, 0, deg_to_rad(45)))

# Поворот вправо  
pawn_skeleton.set_torso_rotation_with_following(Vector3(0, 0, deg_to_rad(-45)))

# Наклон головы
pawn_skeleton.set_head_rotation_with_body_following(Vector3(deg_to_rad(15), 0, 0))
```

## Структура системы

### Основные компоненты

1. **AutoSkeletonController** - основной контроллер
2. **Простые кости** (Node3D) - голова, торс
3. **Скелетные кости** (Skeleton3D) - руки, ноги

### Функции следования

- `set_torso_rotation_with_following()` - поворот торса с автоматическим следованием
- `set_head_rotation_with_body_following()` - поворот головы с следованием тела
- `_make_arms_follow_torso()` - заставляет руки следовать за торсом
- `_make_legs_follow_torso()` - заставляет ноги следовать за торсом

## Настройка интенсивности

Вы можете изменить интенсивность следования, отредактировав коэффициенты в коде:

```gdscript
# В функции _make_arms_follow_torso()
var arm_offset = Vector3(0, 0, torso_rotation.z * 0.4)  # 40% интенсивность

# В функции _make_legs_follow_torso()  
var leg_offset = Vector3(0, 0, torso_rotation.z * 0.3)  # 30% интенсивность
```

## Тестирование

### Быстрый тест

```gdscript
# Запуск теста автоматического следования
test_script._test_automatic_following()
```

### Демо-последовательность

```gdscript
# Запуск демо-последовательности
demo_script._run_demo_sequence()
```

### Управление клавишами

- **T** - Поворот торса с автоматическим следованием
- **H** - Поворот головы с следованием тела  
- **R** - Сброс всех поз
- **D** - Демо-последовательность

## Преимущества

1. **Естественность** - движения выглядят более реалистично
2. **Простота** - не нужно анимировать каждую часть отдельно
3. **Гибкость** - можно настраивать интенсивность следования
4. **Производительность** - меньше вычислений для анимации

## Ограничения

1. **Только по оси Z** - следование работает только для поворотов вокруг вертикальной оси
2. **Фиксированные коэффициенты** - интенсивность следования задана в коде
3. **Простая логика** - нет сложных физических расчетов

## Планы развития

1. **Многоосевое следование** - поддержка следования по всем осям
2. **Динамические коэффициенты** - настройка интенсивности в реальном времени
3. **Физическая модель** - добавление инерции и массы
4. **Инверсная кинематика** - более сложные алгоритмы движения 